import { Injectable } from '@angular/core';
import numbro from 'numbro';
import { DateTime } from 'luxon';
import * as i0 from "@angular/core";
import * as i1 from "../services/servoy_public.service";
const MILLSIGN = '\u2030';
export class Format {
    constructor() {
        this.display = null;
        this.uppercase = false;
        this.lowercase = false;
        this.type = null;
        this.isMask = false;
        this.isRaw = false;
        this.isNumberValidator = false;
        this.edit = null;
        this.placeHolder = '';
        this.percent = '';
        this.allowedCharacters = '';
        this.maxLength = 0;
    }
}
export class FormattingService {
    constructor(servoyService) {
        this.servoyService = servoyService;
    }
    // formatting stufff
    format(data, format, useEditFormat) {
        const formatString = useEditFormat ? format.edit : format.display;
        if ((!format) || (!format.type) || ((typeof data === 'number') && isNaN(data))) {
            if (!format && ((format.type === 'NUMBER') || (format.type === 'INTEGER')) && (typeof data === 'number') && !isNaN(data)) {
                // make sure is always returned with correct type, otherwise compare will not work well
                return data.toString();
            }
            return data;
        }
        if (data === undefined || data === null)
            return '';
        if ((format.type === 'NUMBER') || (format.type === 'INTEGER')) {
            return this.formatNumbers(data, formatString);
        }
        else if (format.type === 'TEXT') {
            let formattedValue = this.formatText(data, formatString);
            if (format.uppercase)
                formattedValue = formattedValue.toUpperCase();
            else if (format.lowercase)
                formattedValue = formattedValue.toLowerCase();
            return formattedValue;
        }
        else if (format.type === 'DATETIME') {
            return this.formatDate(data, formatString);
        }
        return data;
    }
    testKeyPressed(event, keyCode) {
        let code;
        if (!event)
            event = window.event;
        if (!event)
            return false;
        if (event.keyCode)
            code = event.keyCode;
        else if (event.which)
            code = event.which;
        return code === keyCode;
    }
    // test numbers only
    testForNumbersOnly(e, keyChar, vElement, vFindMode, vCheckNumbers, vSvyFormat, skipMaxLength) {
        if (!vFindMode && vCheckNumbers) {
            if (this.testKeyPressed(e, 13) && e.target.tagName.toUpperCase() === 'INPUT') {
                //do not looses focus, just apply the format and push value
                vElement.dispatchEvent(new CustomEvent('change', { bubbles: true, detail: { text: () => vElement.value } }));
            }
            else if (vSvyFormat.type === 'INTEGER') {
                const currentLanguageNumeralSymbols = numbro.languageData();
                if (keyChar === undefined || keyChar === null) {
                    return this.numbersonly(e, false, currentLanguageNumeralSymbols.delimiters.decimal, currentLanguageNumeralSymbols.delimiters.thousands, currentLanguageNumeralSymbols.currency
                        .symbol, vSvyFormat.percent, vElement, skipMaxLength === true ? 0 : vSvyFormat.maxLength);
                }
                else {
                    return this.numbersonlyForChar(keyChar, false, currentLanguageNumeralSymbols.delimiters.decimal, currentLanguageNumeralSymbols.delimiters.thousands, currentLanguageNumeralSymbols.currency.symbol, vSvyFormat.percent, vElement, skipMaxLength === true ? 0 : vSvyFormat.maxLength);
                }
            }
            else if (vSvyFormat.type === 'NUMBER' || ((vSvyFormat.type === 'TEXT') && vSvyFormat.isNumberValidator)) {
                const currentLanguageNumeralSymbols = numbro.languageData();
                if (keyChar === undefined || keyChar === null) {
                    return this.numbersonly(e, true, currentLanguageNumeralSymbols.delimiters.decimal, currentLanguageNumeralSymbols.delimiters.thousands, currentLanguageNumeralSymbols.currency.symbol, vSvyFormat.percent, vElement, skipMaxLength === true ? 0 : vSvyFormat.maxLength);
                }
                else {
                    return this.numbersonlyForChar(keyChar, true, currentLanguageNumeralSymbols.delimiters.decimal, currentLanguageNumeralSymbols.delimiters.thousands, currentLanguageNumeralSymbols.currency.symbol, vSvyFormat.percent, vElement, skipMaxLength === true ? 0 : vSvyFormat.maxLength);
                }
            }
        }
        return true;
    }
    // unformatting stuff
    unformat(data, servoyFormat, type, currentValue) {
        if ((!servoyFormat) || (!type) || (!data && data !== 0))
            return data;
        if ((type === 'NUMBER') || (type === 'INTEGER')) {
            return this.unformatNumbers(data, servoyFormat);
        }
        else if (type === 'TEXT') {
            return data;
        }
        else if (type === 'DATETIME') {
            if ('' === data)
                return null;
            servoyFormat = this.convertFormat(servoyFormat);
            const d = DateTime.fromFormat(data, servoyFormat, { locale: this.servoyService.getLocale() }).toJSDate();
            // if format has not year/month/day use the one from the current model value
            // because luxon will just use current date
            if (currentValue && !isNaN(currentValue.getTime())) {
                if (servoyFormat.indexOf('y') === -1) {
                    d.setFullYear(currentValue.getFullYear());
                }
                if (servoyFormat.indexOf('W') === -1 && servoyFormat.indexOf('o') === -1) {
                    if (servoyFormat.indexOf('M') === -1) {
                        d.setMonth(currentValue.getMonth());
                    }
                    if (servoyFormat.indexOf('d') === -1) {
                        d.setDate(currentValue.getDate());
                    }
                }
            }
            return d;
        }
        return data;
    }
    unformatNumbers(data, format) {
        if (data === '')
            return data;
        //treat scientiffic numbers
        if (data.toString().toLowerCase().indexOf('e') > -1 && !isNaN(data)) {
            return new Number(data).valueOf();
        }
        let multFactor = 1;
        const MILLSIGN = '\u2030';
        if (format.indexOf(MILLSIGN) > -1 && format.indexOf('\'' + MILLSIGN + '\'') == -1) {
            multFactor *= 0.001;
        }
        if (format.indexOf('\'') > -1) {
            // replace the literals
            const parts = format.split('\'');
            for (let i = 0; i < parts.length; i++) {
                if (i % 2 === 1) {
                    data = data.replace(new RegExp(parts[i], 'g'), '');
                }
            }
        }
        let ret = numbro(data).value();
        ret *= multFactor;
        return ret;
    }
    numbersonly(e, decimal, decimalChar, groupingChar, currencyChar, percentChar, vElement, mlength) {
        let key;
        if (window.event) {
            key = window.event['keyCode'];
        }
        else if (e) {
            key = e.which;
        }
        else {
            return true;
        }
        if ((key == null) || (key === 0) || (key === 8) || (key === 9) || (key === 13) || (key === 27) || (e.ctrlKey && key === 97) || (e.ctrlKey && key === 99) ||
            (e.ctrlKey && key === 118) || (e.ctrlKey && key === 120)) { //added CTRL-A, X, C and V
            return true;
        }
        const keychar = String.fromCharCode(key);
        return this.numbersonlyForChar(keychar, decimal, decimalChar, groupingChar, currencyChar, percentChar, vElement, mlength);
    }
    numbersonlyForChar(keychar, decimal, decimalChar, groupingChar, currencyChar, percentChar, vElement, mlength) {
        const value = vElement.value;
        if (mlength > 0 && value) {
            let counter = 0;
            if (('0123456789').indexOf(keychar) !== -1)
                counter++;
            const stringLength = value.length;
            for (let i = 0; i < stringLength; i++) {
                if (('0123456789').indexOf(value.charAt(i)) !== -1)
                    counter++;
            }
            const selectedTxt = this.getSelectedText(vElement);
            if (selectedTxt) {
                // selection will get deleted/replaced by typed key
                for (let i = 0; i < selectedTxt.length; i++) {
                    if (('0123456789').indexOf(selectedTxt.charAt(i)) !== -1)
                        counter--;
                }
            }
            if (counter > mlength)
                return false;
        }
        if ((('-0123456789').indexOf(keychar) > -1)) {
            return true;
        }
        else if (decimal && (keychar === decimalChar)) {
            return true;
        }
        else if (keychar === groupingChar) {
            return true;
        }
        else if (keychar === currencyChar) {
            return true;
        }
        else if (keychar === percentChar) {
            return true;
        }
        return false;
    }
    getSelectedText(textarea) {
        let sel = null;
        if (textarea) {
            const start = textarea['selectionStart'];
            const end = textarea['selectionEnd'];
            sel = textarea['value'].substring(start, end);
        }
        return sel;
    }
    formatNumbers(data, servoyFormat) {
        if (!servoyFormat)
            return data;
        if (data === '')
            return data;
        data = Number(data); // just to make sure that if it was a string representing a number we turn it into a number
        if (typeof data === 'number' && isNaN(data))
            return ''; // cannot format something that is not a number
        const initialData = data;
        let patchedFormat = servoyFormat; // patched format for numeraljs format
        let i;
        let j;
        let prefix = '';
        let sufix = '';
        if (patchedFormat.indexOf(';') > 0) {
            if (data < 0) {
                patchedFormat = patchedFormat.split(';')[1];
            }
            else
                patchedFormat = patchedFormat.split(';')[0];
        }
        if (data < 0)
            data *= -1;
        if (patchedFormat.indexOf('\u00A4') >= 0) {
            patchedFormat = patchedFormat.replace(new RegExp('\u00A4', 'g'), numbro.languageData().currency.symbol);
        }
        if (servoyFormat.indexOf('-') >= 0 && initialData >= 0 && servoyFormat.indexOf(';') < 0) {
            patchedFormat = patchedFormat.replace(new RegExp('-', 'g'), '');
        }
        if (patchedFormat.indexOf('%') > -1 && patchedFormat.indexOf('\'%\'') === -1) {
            data *= 100;
        }
        else if (patchedFormat.indexOf(MILLSIGN) > -1 && patchedFormat.indexOf('\'' + MILLSIGN + '\'') === -1) {
            data *= 1000;
        }
        let numberStart = patchedFormat.length;
        let index = patchedFormat.indexOf('0');
        if (index >= 0) {
            numberStart = index;
        }
        index = patchedFormat.indexOf('#');
        if (index >= 0 && index < numberStart) {
            numberStart = index;
        }
        let numberEnd = 0;
        index = patchedFormat.lastIndexOf('0');
        if (index >= 0) {
            numberEnd = index;
        }
        index = patchedFormat.lastIndexOf('#');
        if (index >= 0 && index > numberEnd) {
            numberEnd = index;
        }
        if (numberStart > 0) {
            prefix = patchedFormat.substring(0, numberStart);
        }
        if (numberEnd < patchedFormat.length - 1) {
            sufix = patchedFormat.substring(numberEnd + 1);
        }
        patchedFormat = patchedFormat.substring(numberStart, numberEnd + 1);
        let ret;
        prefix = prefix.replace(new RegExp('\'', 'g'), '');
        sufix = sufix.replace(new RegExp('\'', 'g'), '');
        if (servoyFormat.indexOf('-') === -1 && initialData < 0 && servoyFormat.indexOf(';') < 0) {
            prefix = prefix + '-';
        }
        // scientific notation case
        if (servoyFormat.indexOf('E') > -1) {
            const frmt = /([0#.,]+)+E0+.*/.exec(patchedFormat)[1];
            let integerDigits = 0;
            let fractionalDigits = 0;
            let countIntegerState = true;
            for (i = 0; i < frmt.length; i++) {
                const chr = frmt[i];
                if (chr === '.') {
                    countIntegerState = false;
                    continue;
                }
                if (chr === ',')
                    continue;
                if (countIntegerState) {
                    integerDigits++;
                }
                else {
                    fractionalDigits++;
                }
            }
            ret = Number(data).toExponential(integerDigits + fractionalDigits);
        }
        else {
            // get min digits
            let minLen = 0;
            let optionalDigits = 0;
            for (i = 0; i < patchedFormat.length; i++) {
                if (patchedFormat[i] === '0') {
                    minLen++;
                }
                else if (patchedFormat[i] === '#' && minLen === 0) {
                    optionalDigits++;
                }
                else if (patchedFormat[i] === '.') {
                    break;
                }
            }
            patchedFormat = patchedFormat.replace(new RegExp('(#+)', 'g'), '[$1]');
            patchedFormat = patchedFormat.replace(new RegExp('#', 'g'), '0');
            ret = numbro(data).format(patchedFormat);
            // set min digits
            if (minLen > 0) {
                const retSplit = ret.split(numbro.languageData().delimiters.decimal);
                for (i = 0; i < retSplit[0].length; i++) {
                    if (retSplit[0][i] < '0' || retSplit[0][i] > '9')
                        continue;
                    for (j = i; j < retSplit[0].length; j++) {
                        if (retSplit[0][j] >= '0' && retSplit[0][j] <= '9')
                            continue;
                        break;
                    }
                    const nrMissing0 = minLen - (j - i);
                    if (nrMissing0 > 0) {
                        ret = retSplit[0].substring(0, i);
                        for (j = 0; j < nrMissing0; j++)
                            ret += '0';
                        ret += retSplit[0].substring(i);
                        if (retSplit.length > 1)
                            ret += (numbro.languageData().delimiters.decimal + retSplit[1]);
                    }
                    break;
                }
            }
            // fix the optional digits
            if (patchedFormat.indexOf(',') === -1 && optionalDigits > 0) {
                let toEliminate = 0;
                for (i = 0; i < ret.length; i++) {
                    if (ret.charAt(i) === '0') {
                        toEliminate++;
                    }
                    else {
                        break;
                    }
                }
                if (toEliminate > 0) {
                    if (toEliminate > optionalDigits) {
                        toEliminate = optionalDigits;
                    }
                    ret = ret.substring(toEliminate);
                    if (ret.indexOf(numbro.languageData().delimiters.decimal) === 0) {
                        // we eliminated too much
                        ret = '0' + ret;
                    }
                }
            }
        }
        return prefix + ret + sufix;
    }
    formatText(data, servoyFormat) {
        if (!servoyFormat)
            return data;
        const error = 'input string not corresponding to format : ' + data + ' , ' + servoyFormat;
        let ret = '';
        let isEscaping = false;
        let offset = 0;
        if (data && typeof data === 'number') {
            data = data.toString();
        }
        for (let i = 0; i < servoyFormat.length; i++) {
            const formatChar = servoyFormat[i];
            const dataChar = data[i - offset];
            if (dataChar === undefined)
                break;
            if (isEscaping && formatChar !== '\'') {
                if (dataChar !== formatChar)
                    throw error;
                ret += dataChar;
                continue;
            }
            switch (formatChar) {
                case '\'':
                    isEscaping = !isEscaping;
                    offset++;
                    break;
                case 'U':
                    if (dataChar.match(/[a-zA-Z\u00C0-\u00ff]/) == null)
                        throw error;
                    ret += dataChar.toUpperCase();
                    break;
                case 'L':
                    if (dataChar.match(/[a-zA-Z\u00C0-\u00ff]/) == null)
                        throw error;
                    ret += dataChar.toLowerCase();
                    break;
                case 'A':
                    if (dataChar.match(/[0-9a-zA-Z\u00C0-\u00ff]/) == null)
                        throw error;
                    ret += dataChar;
                    break;
                case '?':
                    if (dataChar.match(/[a-zA-Z\u00C0-\u00ff]/) == null)
                        throw error;
                    ret += dataChar;
                    break;
                case '*':
                    ret += dataChar;
                    break;
                case 'H':
                    if (dataChar.match(/[0-9a-fA-F]/) == null)
                        throw error;
                    ret += dataChar.toUpperCase();
                    break;
                case '#':
                    if (dataChar.match(/[\d]/) == null)
                        throw error;
                    ret += dataChar;
                    break;
                default:
                    ret += formatChar;
                    if (formatChar !== dataChar)
                        offset++;
                    break;
            }
        }
        return ret;
    }
    formatDate(data, dateFormat) {
        if (!(data instanceof Date))
            return data;
        dateFormat = this.convertFormat(dateFormat);
        const formatted = DateTime.fromJSDate(data).setLocale(this.servoyService.getLocale()).toFormat(dateFormat);
        return formatted.trim ? formatted.trim() : formatted;
    }
    convertFormat(dateFormat) {
        if (!dateFormat)
            dateFormat = 'F'; // long date format of luxon
        // adjust to luxon js formatting (from java simple date format)
        dateFormat = dateFormat.replace(new RegExp('Y', 'g'), 'y');
        dateFormat = dateFormat.replace(new RegExp('aa', 'g'), 'a');
        dateFormat = dateFormat.replace(new RegExp('E', 'g'), 'EEE');
        dateFormat = dateFormat.replace(new RegExp('u', 'g'), 'E');
        dateFormat = dateFormat.replace(new RegExp('w', 'g'), 'W');
        // no equivalent for K, just put h for now
        dateFormat = dateFormat.replace(new RegExp('K', 'g'), 'h');
        dateFormat = dateFormat.replace(new RegExp('k', 'g'), 'H');
        dateFormat = dateFormat.replace(new RegExp('D', 'g'), 'o');
        // if week is found then the year must be 'k' for luxon (iso week year)
        if (dateFormat.indexOf('W') !== -1) {
            dateFormat = dateFormat.replace(new RegExp('y', 'g'), 'k');
        }
        return dateFormat;
    }
}
FormattingService.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.0.2", ngImport: i0, type: FormattingService, deps: [{ token: i1.ServoyPublicService }], target: i0.ɵɵFactoryTarget.Injectable });
FormattingService.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "12.0.2", ngImport: i0, type: FormattingService });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.0.2", ngImport: i0, type: FormattingService, decorators: [{
            type: Injectable
        }], ctorParameters: function () { return [{ type: i1.ServoyPublicService }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZm9ybWF0dGluZy5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvc2Vydm95LXB1YmxpYy9zcmMvbGliL2Zvcm1hdC9mb3JtYXR0aW5nLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzQyxPQUFPLE1BQU0sTUFBTSxRQUFRLENBQUM7QUFDNUIsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLE9BQU8sQ0FBQzs7O0FBR2pDLE1BQU0sUUFBUSxHQUFHLFFBQVEsQ0FBQztBQUUxQixNQUFNLE9BQU8sTUFBTTtJQUFuQjtRQUNJLFlBQU8sR0FBVyxJQUFJLENBQUM7UUFDdkIsY0FBUyxHQUFHLEtBQUssQ0FBQztRQUNsQixjQUFTLEdBQUcsS0FBSyxDQUFDO1FBQ2xCLFNBQUksR0FBVyxJQUFJLENBQUM7UUFDcEIsV0FBTSxHQUFHLEtBQUssQ0FBQztRQUNmLFVBQUssR0FBRyxLQUFLLENBQUM7UUFDZCxzQkFBaUIsR0FBRyxLQUFLLENBQUM7UUFDMUIsU0FBSSxHQUFXLElBQUksQ0FBQztRQUNwQixnQkFBVyxHQUFHLEVBQUUsQ0FBQztRQUNqQixZQUFPLEdBQUcsRUFBRSxDQUFDO1FBQ2Isc0JBQWlCLEdBQUcsRUFBRSxDQUFDO1FBQ3ZCLGNBQVMsR0FBRyxDQUFDLENBQUM7SUFDbEIsQ0FBQztDQUFBO0FBSUQsTUFBTSxPQUFPLGlCQUFpQjtJQUUxQixZQUFvQixhQUFrQztRQUFsQyxrQkFBYSxHQUFiLGFBQWEsQ0FBcUI7SUFDdEQsQ0FBQztJQUVELG9CQUFvQjtJQUNiLE1BQU0sQ0FBQyxJQUFTLEVBQUUsTUFBYyxFQUFFLGFBQXNCO1FBQzNELE1BQU0sWUFBWSxHQUFHLGFBQWEsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQztR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QyxDQUFDO1FBQzNELFVBQVUsR0FBRyxVQUFVLENBQUMsT0FBTyxDQUFDLElBQUksTUFBTSxDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQztRQUMzRCwwQ0FBMEM7UUFDMUMsVUFBVSxHQUFHLFVBQVUsQ0FBQyxPQUFPLENBQUMsSUFBSSxNQUFNLENBQUMsR0FBRyxFQUFDLEdBQUcsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDO1FBQzFELFVBQVUsR0FBRyxVQUFVLENBQUMsT0FBTyxDQUFDLElBQUksTUFBTSxDQUFDLEdBQUcsRUFBQyxHQUFHLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQztRQUMxRCxVQUFVLEdBQUcsVUFBVSxDQUFDLE9BQU8sQ0FBQyxJQUFJLE1BQU0sQ0FBQyxHQUFHLEVBQUMsR0FBRyxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUM7UUFDMUQsdUVBQXVFO1FBQ3ZFLElBQUksVUFBVSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRTtZQUNoQyxVQUFVLEdBQUcsVUFBVSxDQUFDLE9BQU8sQ0FBQyxJQUFJLE1BQU0sQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUM7U0FDOUQ7UUFDRCxPQUFPLFVBQVUsQ0FBQztJQUN0QixDQUFDOzs4R0FoYlEsaUJBQWlCO2tIQUFqQixpQkFBaUI7MkZBQWpCLGlCQUFpQjtrQkFEN0IsVUFBVSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IG51bWJybyBmcm9tICdudW1icm8nO1xyXG5pbXBvcnQgeyBEYXRlVGltZSB9IGZyb20gJ2x1eG9uJztcclxuaW1wb3J0IHsgU2Vydm95UHVibGljU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL3NlcnZveV9wdWJsaWMuc2VydmljZSc7XHJcblxyXG5jb25zdCBNSUxMU0lHTiA9ICdcXHUyMDMwJztcclxuXHJcbmV4cG9ydCBjbGFzcyBGb3JtYXQge1xyXG4gICAgZGlzcGxheTogc3RyaW5nID0gbnVsbDtcclxuICAgIHVwcGVyY2FzZSA9IGZhbHNlO1xyXG4gICAgbG93ZXJjYXNlID0gZmFsc2U7XHJcbiAgICB0eXBlOiBzdHJpbmcgPSBudWxsO1xyXG4gICAgaXNNYXNrID0gZmFsc2U7XHJcbiAgICBpc1JhdyA9IGZhbHNlO1xyXG4gICAgaXNOdW1iZXJWYWxpZGF0b3IgPSBmYWxzZTtcclxuICAgIGVkaXQ6IHN0cmluZyA9IG51bGw7XHJcbiAgICBwbGFjZUhvbGRlciA9ICcnO1xyXG4gICAgcGVyY2VudCA9ICcnO1xyXG4gICAgYWxsb3dlZENoYXJhY3RlcnMgPSAnJztcclxuICAgIG1heExlbmd0aCA9IDA7XHJcbn1cclxuXHJcblxyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBGb3JtYXR0aW5nU2VydmljZSB7XHJcblxyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBzZXJ2b3lTZXJ2aWNlOiBTZXJ2b3lQdWJsaWNTZXJ2aWNlKSB7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gZm9ybWF0dGluZyBzdHVmZmZcclxuICAgIHB1YmxpYyBmb3JtYXQoZGF0YTogYW55LCBmb3JtYXQ6IEZvcm1hdCwgdXNlRWRpdEZvcm1hdDogYm9vbGVhbik6IHN0cmluZyB7XHJcbiAgICAgICAgY29uc3QgZm9ybWF0U3RyaW5nID0gdXNlRWRpdEZvcm1hdCA/IGZvcm1hdC5lZGl0IDogZm9ybWF0LmRpc3BsYXk7XHJcblxyXG4gICAgICAgIGlmICgoIWZvcm1hdCkgfHwgKCFmb3JtYXQudHlwZSkgfHwgKCh0eXBlb2YgZGF0YSA9PT0gJ251bWJlcicpICYmIGlzTmFOKGRhdGEpKSkge1xyXG4gICAgICAgICAgICBpZiAoIWZvcm1hdCAmJiAoKGZvcm1hdC50eXBlID09PSAnTlVNQkVSJykgfHwgKGZvcm1hdC50eXBlID09PSAnSU5URUdFUicpKSAmJiAodHlwZW9mIGRhdGEgPT09ICdudW1iZXInKSAmJiAhaXNOYU4oZGF0YSkpIHtcclxuICAgICAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSBpcyBhbHdheXMgcmV0dXJuZWQgd2l0aCBjb3JyZWN0IHR5cGUsIG90aGVyd2lzZSBjb21wYXJlIHdpbGwgbm90IHdvcmsgd2VsbFxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGEudG9TdHJpbmcoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gZGF0YTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGRhdGEgPT09IHVuZGVmaW5lZCB8fCBkYXRhID09PSBudWxsKSByZXR1cm4gJyc7XHJcbiAgICAgICAgaWYgKChmb3JtYXQudHlwZSA9PT0gJ05VTUJFUicpIHx8IChmb3JtYXQudHlwZSA9PT0gJ0lOVEVHRVInKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5mb3JtYXROdW1iZXJzKGRhdGEsIGZvcm1hdFN0cmluZyk7XHJcbiAgICAgICAgfSBlbHNlIGlmIChmb3JtYXQudHlwZSA9PT0gJ1RFWFQnKSB7XHJcbiAgICAgICAgICAgIGxldCBmb3JtYXR0ZWRWYWx1ZSA9IHRoaXMuZm9ybWF0VGV4dChkYXRhLCBmb3JtYXRTdHJpbmcpO1xyXG4gICAgICAgICAgICBpZiAoZm9ybWF0LnVwcGVyY2FzZSkgZm9ybWF0dGVkVmFsdWUgPSBmb3JtYXR0ZWRWYWx1ZS50b1VwcGVyQ2FzZSgpO1xyXG4gICAgICAgICAgICBlbHNlIGlmIChmb3JtYXQubG93ZXJjYXNlKSBmb3JtYXR0ZWRWYWx1ZSA9IGZvcm1hdHRlZFZhbHVlLnRvTG93ZXJDYXNlKCk7XHJcbiAgICAgICAgICAgIHJldHVybiBmb3JtYXR0ZWRWYWx1ZTtcclxuICAgICAgICB9IGVsc2UgaWYgKGZvcm1hdC50eXBlID09PSAnREFURVRJTUUnKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmZvcm1hdERhdGUoZGF0YSwgZm9ybWF0U3RyaW5nKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGRhdGE7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHRlc3RLZXlQcmVzc2VkKGV2ZW50OiBLZXlib2FyZEV2ZW50LCBrZXlDb2RlOiBudW1iZXIpIHtcclxuICAgICAgICBsZXQgY29kZTogbnVtYmVyO1xyXG5cclxuICAgICAgICBpZiAoIWV2ZW50KSBldmVudCA9IHdpbmRvdy5ldmVudCBhcyBLZXlib2FyZEV2ZW50O1xyXG4gICAgICAgIGlmICghZXZlbnQpIHJldHVybiBmYWxzZTtcclxuICAgICAgICBpZiAoZXZlbnQua2V5Q29kZSkgY29kZSA9IGV2ZW50LmtleUNvZGU7XHJcbiAgICAgICAgZWxzZSBpZiAoZXZlbnQud2hpY2gpIGNvZGUgPSBldmVudC53aGljaDtcclxuICAgICAgICByZXR1cm4gY29kZSA9PT0ga2V5Q29kZTtcclxuICAgIH1cclxuXHJcbiAgICAvLyB0ZXN0IG51bWJlcnMgb25seVxyXG4gICAgcHVibGljIHRlc3RGb3JOdW1iZXJzT25seShlLCBrZXlDaGFyLCB2RWxlbWVudCwgdkZpbmRNb2RlLCB2Q2hlY2tOdW1iZXJzLCB2U3Z5Rm9ybWF0LCBza2lwTWF4TGVuZ3RoKSB7XHJcbiAgICAgICAgaWYgKCF2RmluZE1vZGUgJiYgdkNoZWNrTnVtYmVycykge1xyXG4gICAgICAgICAgICBpZiAodGhpcy50ZXN0S2V5UHJlc3NlZChlLCAxMykgJiYgZS50YXJnZXQudGFnTmFtZS50b1VwcGVyQ2FzZSgpID09PSAnSU5QVVQnKSB7XHJcbiAgICAgICAgICAgICAgICAvL2RvIG5vdCBsb29zZXMgZm9jdXMsIGp1c3QgYXBwbHkgdGhlIGZvcm1hdCBhbmQgcHVzaCB2YWx1ZVxyXG4gICAgICAgICAgICAgICAgdkVsZW1lbnQuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoJ2NoYW5nZScsIHsgYnViYmxlczogdHJ1ZSwgZGV0YWlsOiB7IHRleHQ6ICgpID0+IHZFbGVtZW50LnZhbHVlIH0gfSkpO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHZTdnlGb3JtYXQudHlwZSA9PT0gJ0lOVEVHRVInKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50TGFuZ3VhZ2VOdW1lcmFsU3ltYm9scyA9IG51bWJyby5sYW5ndWFnZURhdGEoKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoa2V5Q2hhciA9PT0gdW5kZWZpbmVkIHx8IGtleUNoYXIgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5udW1iZXJzb25seShlLCBmYWxzZSwgY3VycmVudExhbmd1YWdlTnVtZXJhbFN5bWJvbHMuZGVsaW1pdGVycy5kZWNpbWFsLCBjdXJyZW50TGFuZ3VhZ2VOdW1lcmFsU3ltYm9scy5kZWxpbWl0ZXJzLnRob3VzYW5kcywgY3VycmVudExhbmd1YWdlTnVtZXJhbFN5bWJvbHMuY3VycmVuY3lcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnN5bWJvbCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdlN2eUZvcm1hdC5wZXJjZW50LCB2RWxlbWVudCwgc2tpcE1heExlbmd0aCA9PT0gdHJ1ZSA/IDAgOiB2U3Z5Rm9ybWF0Lm1heExlbmd0aCk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLm51bWJlcnNvbmx5Rm9yQ2hhcihrZXlDaGFyLCBmYWxzZSwgY3VycmVudExhbmd1YWdlTnVtZXJhbFN5bWJvbHMuZGVsaW1pdGVycy5kZWNpbWFsLCBjdXJyZW50TGFuZ3VhZ2VOdW1lcmFsU3ltYm9scy5kZWxpbWl0ZXJzLnRob3VzYW5kcyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudExhbmd1YWdlTnVtZXJhbFN5bWJvbHMuY3VycmVuY3kuc3ltYm9sLCB2U3Z5Rm9ybWF0LnBlcmNlbnQsIHZFbGVtZW50LCBza2lwTWF4TGVuZ3RoID09PSB0cnVlID8gMCA6IHZTdnlGb3JtYXQubWF4TGVuZ3RoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIGlmICh2U3Z5Rm9ybWF0LnR5cGUgPT09ICdOVU1CRVInIHx8ICgodlN2eUZvcm1hdC50eXBlID09PSAnVEVYVCcpICYmIHZTdnlGb3JtYXQuaXNOdW1iZXJWYWxpZGF0b3IpKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50TGFuZ3VhZ2VOdW1lcmFsU3ltYm9scyA9IG51bWJyby5sYW5ndWFnZURhdGEoKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoa2V5Q2hhciA9PT0gdW5kZWZpbmVkIHx8IGtleUNoYXIgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5udW1iZXJzb25seShlLCB0cnVlLCBjdXJyZW50TGFuZ3VhZ2VOdW1lcmFsU3ltYm9scy5kZWxpbWl0ZXJzLmRlY2ltYWwsIGN1cnJlbnRMYW5ndWFnZU51bWVyYWxTeW1ib2xzLmRlbGltaXRlcnMudGhvdXNhbmRzLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50TGFuZ3VhZ2VOdW1lcmFsU3ltYm9scy5jdXJyZW5jeS5zeW1ib2wsIHZTdnlGb3JtYXQucGVyY2VudCwgdkVsZW1lbnQsIHNraXBNYXhMZW5ndGggPT09IHRydWUgPyAwIDogdlN2eUZvcm1hdC5tYXhMZW5ndGgpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5udW1iZXJzb25seUZvckNoYXIoa2V5Q2hhciwgdHJ1ZSwgY3VycmVudExhbmd1YWdlTnVtZXJhbFN5bWJvbHMuZGVsaW1pdGVycy5kZWNpbWFsLCBjdXJyZW50TGFuZ3VhZ2VOdW1lcmFsU3ltYm9scy5kZWxpbWl0ZXJzLnRob3VzYW5kcyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudExhbmd1YWdlTnVtZXJhbFN5bWJvbHMuY3VycmVuY3kuc3ltYm9sLCB2U3Z5Rm9ybWF0LnBlcmNlbnQsIHZFbGVtZW50LCBza2lwTWF4TGVuZ3RoID09PSB0cnVlID8gMCA6IHZTdnlGb3JtYXQubWF4TGVuZ3RoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuXHJcbiAgICAvLyB1bmZvcm1hdHRpbmcgc3R1ZmZcclxuXHJcbiAgICBwdWJsaWMgdW5mb3JtYXQoZGF0YTogYW55LCBzZXJ2b3lGb3JtYXQ6IHN0cmluZywgdHlwZTogc3RyaW5nLCBjdXJyZW50VmFsdWU/OiBhbnkpIHtcclxuICAgICAgICBpZiAoKCFzZXJ2b3lGb3JtYXQpIHx8ICghdHlwZSkgfHwgKCFkYXRhICYmIGRhdGEgIT09IDApKSByZXR1cm4gZGF0YTtcclxuICAgICAgICBpZiAoKHR5cGUgPT09ICdOVU1CRVInKSB8fCAodHlwZSA9PT0gJ0lOVEVHRVInKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy51bmZvcm1hdE51bWJlcnMoZGF0YSwgc2Vydm95Rm9ybWF0KTtcclxuICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT09ICdURVhUJykge1xyXG4gICAgICAgICAgICByZXR1cm4gZGF0YTtcclxuICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT09ICdEQVRFVElNRScpIHtcclxuICAgICAgICAgICAgaWYgKCcnID09PSBkYXRhKSByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICBzZXJ2b3lGb3JtYXQgPSB0aGlzLmNvbnZlcnRGb3JtYXQoc2Vydm95Rm9ybWF0KTtcclxuICAgICAgICAgICAgY29uc3QgZCA9IERhdGVUaW1lLmZyb21Gb3JtYXQoZGF0YSwgc2Vydm95Rm9ybWF0LCB7bG9jYWxlOiB0aGlzLnNlcnZveVNlcnZpY2UuZ2V0TG9jYWxlKCl9KS50b0pTRGF0ZSgpO1xyXG4gICAgICAgICAgICAvLyBpZiBmb3JtYXQgaGFzIG5vdCB5ZWFyL21vbnRoL2RheSB1c2UgdGhlIG9uZSBmcm9tIHRoZSBjdXJyZW50IG1vZGVsIHZhbHVlXHJcbiAgICAgICAgICAgIC8vIGJlY2F1c2UgbHV4b24gd2lsbCBqdXN0IHVzZSBjdXJyZW50IGRhdGVcclxuICAgICAgICAgICAgaWYgKGN1cnJlbnRWYWx1ZSAmJiAhaXNOYU4oY3VycmVudFZhbHVlLmdldFRpbWUoKSkpIHtcclxuICAgICAgICAgICAgICAgIGlmIChzZXJ2b3lGb3JtYXQuaW5kZXhPZigneScpID09PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGQuc2V0RnVsbFllYXIoY3VycmVudFZhbHVlLmdldEZ1bGxZZWFyKCkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKHNlcnZveUZvcm1hdC5pbmRleE9mKCdXJykgPT09IC0xICYmIHNlcnZveUZvcm1hdC5pbmRleE9mKCdvJykgPT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNlcnZveUZvcm1hdC5pbmRleE9mKCdNJykgPT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGQuc2V0TW9udGgoY3VycmVudFZhbHVlLmdldE1vbnRoKCkpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2Vydm95Rm9ybWF0LmluZGV4T2YoJ2QnKSA9PT0gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZC5zZXREYXRlKGN1cnJlbnRWYWx1ZS5nZXREYXRlKCkpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gZDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGRhdGE7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSB1bmZvcm1hdE51bWJlcnMoZGF0YTogYW55LCBmb3JtYXQ6IHN0cmluZykgeyAvLyB0b2RvIHRocm93IGVycm9yIHdoZW4gbm90IGNvcmVzcG9uZGluZyB0byBmb3JtYXQgKHJlaW1wbGVtZW50IHdpdGggc3RhdGUgbWFjaGluZSlcclxuICAgICAgICBpZiAoZGF0YSA9PT0gJycpIHJldHVybiBkYXRhO1xyXG4gICAgICAgIC8vdHJlYXQgc2NpZW50aWZmaWMgbnVtYmVyc1xyXG4gICAgICAgIGlmIChkYXRhLnRvU3RyaW5nKCkudG9Mb3dlckNhc2UoKS5pbmRleE9mKCdlJykgPiAtMSAmJiAhaXNOYU4oZGF0YSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBOdW1iZXIoZGF0YSkudmFsdWVPZigpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbGV0IG11bHRGYWN0b3IgPSAxO1xyXG4gICAgICAgIGNvbnN0IE1JTExTSUdOID0gJ1xcdTIwMzAnO1xyXG4gICAgICAgIGlmIChmb3JtYXQuaW5kZXhPZihNSUxMU0lHTikgPiAtMSAmJiBmb3JtYXQuaW5kZXhPZignXFwnJyArIE1JTExTSUdOICsgJ1xcJycpID09IC0xKSB7XHJcbiAgICAgICAgICAgIG11bHRGYWN0b3IgKj0gMC4wMDE7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChmb3JtYXQuaW5kZXhPZignXFwnJykgPiAtMSkge1xyXG4gICAgICAgICAgICAvLyByZXBsYWNlIHRoZSBsaXRlcmFsc1xyXG4gICAgICAgICAgICBjb25zdCBwYXJ0cyA9IGZvcm1hdC5zcGxpdCgnXFwnJyk7XHJcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcGFydHMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGlmIChpICUgMiA9PT0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGRhdGEgPSBkYXRhLnJlcGxhY2UobmV3IFJlZ0V4cChwYXJ0c1tpXSwgJ2cnKSwgJycpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxldCByZXQgPSBudW1icm8oZGF0YSkudmFsdWUoKTtcclxuICAgICAgICByZXQgKj0gbXVsdEZhY3RvcjtcclxuICAgICAgICByZXR1cm4gcmV0O1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgbnVtYmVyc29ubHkoZSwgZGVjaW1hbCwgZGVjaW1hbENoYXIsIGdyb3VwaW5nQ2hhciwgY3VycmVuY3lDaGFyLCBwZXJjZW50Q2hhciwgdkVsZW1lbnQsIG1sZW5ndGgpIHtcclxuICAgICAgICBsZXQga2V5O1xyXG5cclxuICAgICAgICBpZiAod2luZG93LmV2ZW50KSB7XHJcbiAgICAgICAgICAgIGtleSA9IHdpbmRvdy5ldmVudFsna2V5Q29kZSddO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoZSkge1xyXG4gICAgICAgICAgICBrZXkgPSBlLndoaWNoO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKChrZXkgPT0gbnVsbCkgfHwgKGtleSA9PT0gMCkgfHwgKGtleSA9PT0gOCkgfHwgKGtleSA9PT0gOSkgfHwgKGtleSA9PT0gMTMpIHx8IChrZXkgPT09IDI3KSB8fCAoZS5jdHJsS2V5ICYmIGtleSA9PT0gOTcpIHx8IChlLmN0cmxLZXkgJiYga2V5ID09PSA5OSkgfHxcclxuICAgICAgICAgICAgKGUuY3RybEtleSAmJiBrZXkgPT09IDExOCkgfHwgKGUuY3RybEtleSAmJiBrZXkgPT09IDEyMCkpIHsgLy9hZGRlZCBDVFJMLUEsIFgsIEMgYW5kIFZcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBrZXljaGFyID0gU3RyaW5nLmZyb21DaGFyQ29kZShrZXkpO1xyXG4gICAgICAgIHJldHVybiB0aGlzLm51bWJlcnNvbmx5Rm9yQ2hhcihrZXljaGFyLCBkZWNpbWFsLCBkZWNpbWFsQ2hhciwgZ3JvdXBpbmdDaGFyLCBjdXJyZW5jeUNoYXIsIHBlcmNlbnRDaGFyLCB2RWxlbWVudCwgbWxlbmd0aCk7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgbnVtYmVyc29ubHlGb3JDaGFyKGtleWNoYXIsIGRlY2ltYWwsIGRlY2ltYWxDaGFyLCBncm91cGluZ0NoYXIsIGN1cnJlbmN5Q2hhciwgcGVyY2VudENoYXIsIHZFbGVtZW50LCBtbGVuZ3RoKSB7XHJcbiAgICAgICAgY29uc3QgdmFsdWUgPSB2RWxlbWVudC52YWx1ZTtcclxuICAgICAgICBpZiAobWxlbmd0aCA+IDAgJiYgdmFsdWUpIHtcclxuICAgICAgICAgICAgbGV0IGNvdW50ZXIgPSAwO1xyXG4gICAgICAgICAgICBpZiAoKCcwMTIzNDU2Nzg5JykuaW5kZXhPZihrZXljaGFyKSAhPT0gLTEpIGNvdW50ZXIrKztcclxuICAgICAgICAgICAgY29uc3Qgc3RyaW5nTGVuZ3RoID0gdmFsdWUubGVuZ3RoO1xyXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHN0cmluZ0xlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoKCcwMTIzNDU2Nzg5JykuaW5kZXhPZih2YWx1ZS5jaGFyQXQoaSkpICE9PSAtMSkgY291bnRlcisrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnN0IHNlbGVjdGVkVHh0ID0gdGhpcy5nZXRTZWxlY3RlZFRleHQodkVsZW1lbnQpO1xyXG4gICAgICAgICAgICBpZiAoc2VsZWN0ZWRUeHQpIHtcclxuICAgICAgICAgICAgICAgIC8vIHNlbGVjdGlvbiB3aWxsIGdldCBkZWxldGVkL3JlcGxhY2VkIGJ5IHR5cGVkIGtleVxyXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzZWxlY3RlZFR4dC5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICgoJzAxMjM0NTY3ODknKS5pbmRleE9mKHNlbGVjdGVkVHh0LmNoYXJBdChpKSkgIT09IC0xKSBjb3VudGVyLS07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGNvdW50ZXIgPiBtbGVuZ3RoKSByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoKCgnLTAxMjM0NTY3ODknKS5pbmRleE9mKGtleWNoYXIpID4gLTEpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoZGVjaW1hbCAmJiAoa2V5Y2hhciA9PT0gZGVjaW1hbENoYXIpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoa2V5Y2hhciA9PT0gZ3JvdXBpbmdDaGFyKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoa2V5Y2hhciA9PT0gY3VycmVuY3lDaGFyKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoa2V5Y2hhciA9PT0gcGVyY2VudENoYXIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldFNlbGVjdGVkVGV4dCh0ZXh0YXJlYSkge1xyXG4gICAgICAgIGxldCBzZWwgPSBudWxsO1xyXG4gICAgICAgIGlmICh0ZXh0YXJlYSkge1xyXG4gICAgICAgICAgICBjb25zdCBzdGFydCA9IHRleHRhcmVhWydzZWxlY3Rpb25TdGFydCddO1xyXG4gICAgICAgICAgICBjb25zdCBlbmQgPSB0ZXh0YXJlYVsnc2VsZWN0aW9uRW5kJ107XHJcbiAgICAgICAgICAgIHNlbCA9IHRleHRhcmVhWyd2YWx1ZSddLnN1YnN0cmluZyhzdGFydCwgZW5kKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHNlbDtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGZvcm1hdE51bWJlcnMoZGF0YSwgc2Vydm95Rm9ybWF0OiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gICAgICAgIGlmICghc2Vydm95Rm9ybWF0KVxyXG4gICAgICAgICAgICByZXR1cm4gZGF0YTtcclxuICAgICAgICBpZiAoZGF0YSA9PT0gJycpXHJcbiAgICAgICAgICAgIHJldHVybiBkYXRhO1xyXG5cclxuICAgICAgICBkYXRhID0gTnVtYmVyKGRhdGEpOyAvLyBqdXN0IHRvIG1ha2Ugc3VyZSB0aGF0IGlmIGl0IHdhcyBhIHN0cmluZyByZXByZXNlbnRpbmcgYSBudW1iZXIgd2UgdHVybiBpdCBpbnRvIGEgbnVtYmVyXHJcbiAgICAgICAgaWYgKHR5cGVvZiBkYXRhID09PSAnbnVtYmVyJyAmJiBpc05hTihkYXRhKSkgcmV0dXJuICcnOyAvLyBjYW5ub3QgZm9ybWF0IHNvbWV0aGluZyB0aGF0IGlzIG5vdCBhIG51bWJlclxyXG5cclxuICAgICAgICBjb25zdCBpbml0aWFsRGF0YSA9IGRhdGE7XHJcbiAgICAgICAgbGV0IHBhdGNoZWRGb3JtYXQgPSBzZXJ2b3lGb3JtYXQ7IC8vIHBhdGNoZWQgZm9ybWF0IGZvciBudW1lcmFsanMgZm9ybWF0XHJcbiAgICAgICAgbGV0IGk7IGxldCBqO1xyXG4gICAgICAgIGxldCBwcmVmaXggPSAnJztcclxuICAgICAgICBsZXQgc3VmaXggPSAnJztcclxuXHJcblxyXG4gICAgICAgIGlmIChwYXRjaGVkRm9ybWF0LmluZGV4T2YoJzsnKSA+IDApIHtcclxuICAgICAgICAgICAgaWYgKGRhdGEgPCAwKSB7XHJcbiAgICAgICAgICAgICAgICBwYXRjaGVkRm9ybWF0ID0gcGF0Y2hlZEZvcm1hdC5zcGxpdCgnOycpWzFdO1xyXG4gICAgICAgICAgICB9IGVsc2UgcGF0Y2hlZEZvcm1hdCA9IHBhdGNoZWRGb3JtYXQuc3BsaXQoJzsnKVswXTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChkYXRhIDwgMCkgZGF0YSAqPSAtMTtcclxuICAgICAgICBpZiAocGF0Y2hlZEZvcm1hdC5pbmRleE9mKCdcXHUwMEE0JykgPj0gMCkge1xyXG4gICAgICAgICAgICBwYXRjaGVkRm9ybWF0ID0gcGF0Y2hlZEZvcm1hdC5yZXBsYWNlKG5ldyBSZWdFeHAoJ1xcdTAwQTQnLCAnZycpLCBudW1icm8ubGFuZ3VhZ2VEYXRhKCkuY3VycmVuY3kuc3ltYm9sKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHNlcnZveUZvcm1hdC5pbmRleE9mKCctJykgPj0gMCAmJiBpbml0aWFsRGF0YSA+PSAwICYmIHNlcnZveUZvcm1hdC5pbmRleE9mKCc7JykgPCAwKSB7XHJcbiAgICAgICAgICAgIHBhdGNoZWRGb3JtYXQgPSBwYXRjaGVkRm9ybWF0LnJlcGxhY2UobmV3IFJlZ0V4cCgnLScsICdnJyksICcnKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChwYXRjaGVkRm9ybWF0LmluZGV4T2YoJyUnKSA+IC0xICYmIHBhdGNoZWRGb3JtYXQuaW5kZXhPZignXFwnJVxcJycpID09PSAtMSkge1xyXG4gICAgICAgICAgICBkYXRhICo9IDEwMDtcclxuICAgICAgICB9IGVsc2UgaWYgKHBhdGNoZWRGb3JtYXQuaW5kZXhPZihNSUxMU0lHTikgPiAtMSAmJiBwYXRjaGVkRm9ybWF0LmluZGV4T2YoJ1xcJycgKyBNSUxMU0lHTiArICdcXCcnKSA9PT0gLTEpIHtcclxuICAgICAgICAgICAgZGF0YSAqPSAxMDAwO1xyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgbnVtYmVyU3RhcnQgPSBwYXRjaGVkRm9ybWF0Lmxlbmd0aDtcclxuICAgICAgICBsZXQgaW5kZXggPSBwYXRjaGVkRm9ybWF0LmluZGV4T2YoJzAnKTtcclxuICAgICAgICBpZiAoaW5kZXggPj0gMCkge1xyXG4gICAgICAgICAgICBudW1iZXJTdGFydCA9IGluZGV4O1xyXG4gICAgICAgIH1cclxuICAgICAgICBpbmRleCA9IHBhdGNoZWRGb3JtYXQuaW5kZXhPZignIycpO1xyXG4gICAgICAgIGlmIChpbmRleCA+PSAwICYmIGluZGV4IDwgbnVtYmVyU3RhcnQpIHtcclxuICAgICAgICAgICAgbnVtYmVyU3RhcnQgPSBpbmRleDtcclxuICAgICAgICB9XHJcbiAgICAgICAgbGV0IG51bWJlckVuZCA9IDA7XHJcbiAgICAgICAgaW5kZXggPSBwYXRjaGVkRm9ybWF0Lmxhc3RJbmRleE9mKCcwJyk7XHJcbiAgICAgICAgaWYgKGluZGV4ID49IDApIHtcclxuICAgICAgICAgICAgbnVtYmVyRW5kID0gaW5kZXg7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGluZGV4ID0gcGF0Y2hlZEZvcm1hdC5sYXN0SW5kZXhPZignIycpO1xyXG4gICAgICAgIGlmIChpbmRleCA+PSAwICYmIGluZGV4ID4gbnVtYmVyRW5kKSB7XHJcbiAgICAgICAgICAgIG51bWJlckVuZCA9IGluZGV4O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKG51bWJlclN0YXJ0ID4gMCkge1xyXG4gICAgICAgICAgICBwcmVmaXggPSBwYXRjaGVkRm9ybWF0LnN1YnN0cmluZygwLCBudW1iZXJTdGFydCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAobnVtYmVyRW5kIDwgcGF0Y2hlZEZvcm1hdC5sZW5ndGggLSAxKSB7XHJcbiAgICAgICAgICAgIHN1Zml4ID0gcGF0Y2hlZEZvcm1hdC5zdWJzdHJpbmcobnVtYmVyRW5kICsgMSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwYXRjaGVkRm9ybWF0ID0gcGF0Y2hlZEZvcm1hdC5zdWJzdHJpbmcobnVtYmVyU3RhcnQsIG51bWJlckVuZCArIDEpO1xyXG4gICAgICAgIGxldCByZXQ7XHJcblxyXG5cclxuICAgICAgICBwcmVmaXggPSBwcmVmaXgucmVwbGFjZShuZXcgUmVnRXhwKCdcXCcnLCAnZycpLCAnJyk7XHJcbiAgICAgICAgc3VmaXggPSBzdWZpeC5yZXBsYWNlKG5ldyBSZWdFeHAoJ1xcJycsICdnJyksICcnKTtcclxuXHJcbiAgICAgICAgaWYgKHNlcnZveUZvcm1hdC5pbmRleE9mKCctJykgPT09IC0xICYmIGluaXRpYWxEYXRhIDwgMCAmJiBzZXJ2b3lGb3JtYXQuaW5kZXhPZignOycpIDwgMCkge1xyXG4gICAgICAgICAgICBwcmVmaXggPSBwcmVmaXggKyAnLSc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIHNjaWVudGlmaWMgbm90YXRpb24gY2FzZVxyXG4gICAgICAgIGlmIChzZXJ2b3lGb3JtYXQuaW5kZXhPZignRScpID4gLTEpIHtcclxuICAgICAgICAgICAgY29uc3QgZnJtdCA9IC8oWzAjLixdKykrRTArLiovLmV4ZWMocGF0Y2hlZEZvcm1hdClbMV07XHJcbiAgICAgICAgICAgIGxldCBpbnRlZ2VyRGlnaXRzID0gMDtcclxuICAgICAgICAgICAgbGV0IGZyYWN0aW9uYWxEaWdpdHMgPSAwO1xyXG4gICAgICAgICAgICBsZXQgY291bnRJbnRlZ2VyU3RhdGUgPSB0cnVlO1xyXG4gICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgZnJtdC5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgY2hyID0gZnJtdFtpXTtcclxuICAgICAgICAgICAgICAgIGlmIChjaHIgPT09ICcuJykge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvdW50SW50ZWdlclN0YXRlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoY2hyID09PSAnLCcpIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNvdW50SW50ZWdlclN0YXRlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaW50ZWdlckRpZ2l0cysrO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBmcmFjdGlvbmFsRGlnaXRzKys7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0ID0gTnVtYmVyKGRhdGEpLnRvRXhwb25lbnRpYWwoaW50ZWdlckRpZ2l0cyArIGZyYWN0aW9uYWxEaWdpdHMpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIGdldCBtaW4gZGlnaXRzXHJcbiAgICAgICAgICAgIGxldCBtaW5MZW4gPSAwO1xyXG4gICAgICAgICAgICBsZXQgb3B0aW9uYWxEaWdpdHMgPSAwO1xyXG4gICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgcGF0Y2hlZEZvcm1hdC5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgaWYgKHBhdGNoZWRGb3JtYXRbaV0gPT09ICcwJykge1xyXG4gICAgICAgICAgICAgICAgICAgIG1pbkxlbisrO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChwYXRjaGVkRm9ybWF0W2ldID09PSAnIycgJiYgbWluTGVuID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9uYWxEaWdpdHMrKztcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocGF0Y2hlZEZvcm1hdFtpXSA9PT0gJy4nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHBhdGNoZWRGb3JtYXQgPSBwYXRjaGVkRm9ybWF0LnJlcGxhY2UobmV3IFJlZ0V4cCgnKCMrKScsICdnJyksICdbJDFdJyk7XHJcbiAgICAgICAgICAgIHBhdGNoZWRGb3JtYXQgPSBwYXRjaGVkRm9ybWF0LnJlcGxhY2UobmV3IFJlZ0V4cCgnIycsICdnJyksICcwJyk7XHJcblxyXG4gICAgICAgICAgICByZXQgPSBudW1icm8oZGF0YSkuZm9ybWF0KHBhdGNoZWRGb3JtYXQpO1xyXG5cclxuICAgICAgICAgICAgLy8gc2V0IG1pbiBkaWdpdHNcclxuICAgICAgICAgICAgaWYgKG1pbkxlbiA+IDApIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHJldFNwbGl0ID0gcmV0LnNwbGl0KG51bWJyby5sYW5ndWFnZURhdGEoKS5kZWxpbWl0ZXJzLmRlY2ltYWwpO1xyXG4gICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHJldFNwbGl0WzBdLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJldFNwbGl0WzBdW2ldIDwgJzAnIHx8IHJldFNwbGl0WzBdW2ldID4gJzknKSBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKGogPSBpOyBqIDwgcmV0U3BsaXRbMF0ubGVuZ3RoOyBqKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJldFNwbGl0WzBdW2pdID49ICcwJyAmJiByZXRTcGxpdFswXVtqXSA8PSAnOScpIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbnJNaXNzaW5nMCA9IG1pbkxlbiAtIChqIC0gaSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5yTWlzc2luZzAgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldCA9IHJldFNwbGl0WzBdLnN1YnN0cmluZygwLCBpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChqID0gMDsgaiA8IG5yTWlzc2luZzA7IGorKykgcmV0ICs9ICcwJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0ICs9IHJldFNwbGl0WzBdLnN1YnN0cmluZyhpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJldFNwbGl0Lmxlbmd0aCA+IDEpIHJldCArPSAobnVtYnJvLmxhbmd1YWdlRGF0YSgpLmRlbGltaXRlcnMuZGVjaW1hbCArIHJldFNwbGl0WzFdKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8gZml4IHRoZSBvcHRpb25hbCBkaWdpdHNcclxuICAgICAgICAgICAgaWYgKHBhdGNoZWRGb3JtYXQuaW5kZXhPZignLCcpID09PSAtMSAmJiBvcHRpb25hbERpZ2l0cyA+IDApIHtcclxuICAgICAgICAgICAgICAgIGxldCB0b0VsaW1pbmF0ZSA9IDA7XHJcbiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgcmV0Lmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJldC5jaGFyQXQoaSkgPT09ICcwJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0b0VsaW1pbmF0ZSsrO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICh0b0VsaW1pbmF0ZSA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodG9FbGltaW5hdGUgPiBvcHRpb25hbERpZ2l0cykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0b0VsaW1pbmF0ZSA9IG9wdGlvbmFsRGlnaXRzO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICByZXQgPSByZXQuc3Vic3RyaW5nKHRvRWxpbWluYXRlKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocmV0LmluZGV4T2YobnVtYnJvLmxhbmd1YWdlRGF0YSgpLmRlbGltaXRlcnMuZGVjaW1hbCkgPT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gd2UgZWxpbWluYXRlZCB0b28gbXVjaFxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXQgPSAnMCcgKyByZXQ7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBwcmVmaXggKyByZXQgKyBzdWZpeDtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGZvcm1hdFRleHQoZGF0YSwgc2Vydm95Rm9ybWF0OiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gICAgICAgIGlmICghc2Vydm95Rm9ybWF0KSByZXR1cm4gZGF0YTtcclxuICAgICAgICBjb25zdCBlcnJvciA9ICdpbnB1dCBzdHJpbmcgbm90IGNvcnJlc3BvbmRpbmcgdG8gZm9ybWF0IDogJyArIGRhdGEgKyAnICwgJyArIHNlcnZveUZvcm1hdDtcclxuICAgICAgICBsZXQgcmV0ID0gJyc7XHJcbiAgICAgICAgbGV0IGlzRXNjYXBpbmcgPSBmYWxzZTtcclxuICAgICAgICBsZXQgb2Zmc2V0ID0gMDtcclxuICAgICAgICBpZiAoZGF0YSAmJiB0eXBlb2YgZGF0YSA9PT0gJ251bWJlcicpIHtcclxuICAgICAgICAgICAgZGF0YSA9IGRhdGEudG9TdHJpbmcoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzZXJ2b3lGb3JtYXQubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgY29uc3QgZm9ybWF0Q2hhciA9IHNlcnZveUZvcm1hdFtpXTtcclxuICAgICAgICAgICAgY29uc3QgZGF0YUNoYXIgPSBkYXRhW2kgLSBvZmZzZXRdO1xyXG4gICAgICAgICAgICBpZiAoZGF0YUNoYXIgPT09IHVuZGVmaW5lZCkgYnJlYWs7XHJcbiAgICAgICAgICAgIGlmIChpc0VzY2FwaW5nICYmIGZvcm1hdENoYXIgIT09ICdcXCcnKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZGF0YUNoYXIgIT09IGZvcm1hdENoYXIpIHRocm93IGVycm9yO1xyXG4gICAgICAgICAgICAgICAgcmV0ICs9IGRhdGFDaGFyO1xyXG4gICAgICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc3dpdGNoIChmb3JtYXRDaGFyKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdcXCcnOlxyXG4gICAgICAgICAgICAgICAgICAgIGlzRXNjYXBpbmcgPSAhaXNFc2NhcGluZztcclxuICAgICAgICAgICAgICAgICAgICBvZmZzZXQrKztcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgJ1UnOlxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChkYXRhQ2hhci5tYXRjaCgvW2EtekEtWlxcdTAwQzAtXFx1MDBmZl0vKSA9PSBudWxsKSB0aHJvdyBlcnJvcjtcclxuICAgICAgICAgICAgICAgICAgICByZXQgKz0gZGF0YUNoYXIudG9VcHBlckNhc2UoKTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgJ0wnOlxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChkYXRhQ2hhci5tYXRjaCgvW2EtekEtWlxcdTAwQzAtXFx1MDBmZl0vKSA9PSBudWxsKSB0aHJvdyBlcnJvcjtcclxuICAgICAgICAgICAgICAgICAgICByZXQgKz0gZGF0YUNoYXIudG9Mb3dlckNhc2UoKTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgJ0EnOlxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChkYXRhQ2hhci5tYXRjaCgvWzAtOWEtekEtWlxcdTAwQzAtXFx1MDBmZl0vKSA9PSBudWxsKSB0aHJvdyBlcnJvcjtcclxuICAgICAgICAgICAgICAgICAgICByZXQgKz0gZGF0YUNoYXI7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlICc/JzpcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YUNoYXIubWF0Y2goL1thLXpBLVpcXHUwMEMwLVxcdTAwZmZdLykgPT0gbnVsbCkgdGhyb3cgZXJyb3I7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0ICs9IGRhdGFDaGFyO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnKic6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0ICs9IGRhdGFDaGFyO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnSCc6XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGFDaGFyLm1hdGNoKC9bMC05YS1mQS1GXS8pID09IG51bGwpIHRocm93IGVycm9yO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldCArPSBkYXRhQ2hhci50b1VwcGVyQ2FzZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnIyc6XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGFDaGFyLm1hdGNoKC9bXFxkXS8pID09IG51bGwpIHRocm93IGVycm9yO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldCArPSBkYXRhQ2hhcjtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0ICs9IGZvcm1hdENoYXI7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZvcm1hdENoYXIgIT09IGRhdGFDaGFyKSBvZmZzZXQrKztcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmV0O1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZm9ybWF0RGF0ZShkYXRhLCBkYXRlRm9ybWF0OiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gICAgICAgIGlmICghKGRhdGEgaW5zdGFuY2VvZiBEYXRlKSkgcmV0dXJuIGRhdGE7XHJcbiAgICAgICAgZGF0ZUZvcm1hdCA9IHRoaXMuY29udmVydEZvcm1hdChkYXRlRm9ybWF0KTtcclxuICAgICAgICBjb25zdCBmb3JtYXR0ZWQgID0gRGF0ZVRpbWUuZnJvbUpTRGF0ZShkYXRhKS5zZXRMb2NhbGUodGhpcy5zZXJ2b3lTZXJ2aWNlLmdldExvY2FsZSgpKS50b0Zvcm1hdChkYXRlRm9ybWF0KTtcclxuICAgICAgICByZXR1cm4gZm9ybWF0dGVkLnRyaW0gPyBmb3JtYXR0ZWQudHJpbSgpIDogZm9ybWF0dGVkO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgY29udmVydEZvcm1hdChkYXRlRm9ybWF0OiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gICAgICAgIGlmICghZGF0ZUZvcm1hdCkgZGF0ZUZvcm1hdCA9ICdGJzsgLy8gbG9uZyBkYXRlIGZvcm1hdCBvZiBsdXhvblxyXG4gICAgICAgIC8vIGFkanVzdCB0byBsdXhvbiBqcyBmb3JtYXR0aW5nIChmcm9tIGphdmEgc2ltcGxlIGRhdGUgZm9ybWF0KVxyXG4gICAgICAgIGRhdGVGb3JtYXQgPSBkYXRlRm9ybWF0LnJlcGxhY2UobmV3IFJlZ0V4cCgnWScsICdnJyksICd5Jyk7XHJcbiAgICAgICAgZGF0ZUZvcm1hdCA9IGRhdGVGb3JtYXQucmVwbGFjZShuZXcgUmVnRXhwKCdhYScsICdnJyksICdhJyk7XHJcbiAgICAgICAgZGF0ZUZvcm1hdCA9IGRhdGVGb3JtYXQucmVwbGFjZShuZXcgUmVnRXhwKCdFJywgJ2cnKSwgJ0VFRScpO1xyXG4gICAgICAgIGRhdGVGb3JtYXQgPSBkYXRlRm9ybWF0LnJlcGxhY2UobmV3IFJlZ0V4cCgndScsICdnJyksICdFJyk7XHJcbiAgICAgICAgZGF0ZUZvcm1hdCA9IGRhdGVGb3JtYXQucmVwbGFjZShuZXcgUmVnRXhwKCd3JywgJ2cnKSwgJ1cnKTtcclxuICAgICAgICAvLyBubyBlcXVpdmFsZW50IGZvciBLLCBqdXN0IHB1dCBoIGZvciBub3dcclxuICAgICAgICBkYXRlRm9ybWF0ID0gZGF0ZUZvcm1hdC5yZXBsYWNlKG5ldyBSZWdFeHAoJ0snLCdnJyksICdoJyk7XHJcbiAgICAgICAgZGF0ZUZvcm1hdCA9IGRhdGVGb3JtYXQucmVwbGFjZShuZXcgUmVnRXhwKCdrJywnZycpLCAnSCcpO1xyXG4gICAgICAgIGRhdGVGb3JtYXQgPSBkYXRlRm9ybWF0LnJlcGxhY2UobmV3IFJlZ0V4cCgnRCcsJ2cnKSwgJ28nKTtcclxuICAgICAgICAvLyBpZiB3ZWVrIGlzIGZvdW5kIHRoZW4gdGhlIHllYXIgbXVzdCBiZSAnaycgZm9yIGx1eG9uIChpc28gd2VlayB5ZWFyKVxyXG4gICAgICAgIGlmIChkYXRlRm9ybWF0LmluZGV4T2YoJ1cnKSAhPT0gLTEpIHtcclxuICAgICAgICAgICAgZGF0ZUZvcm1hdCA9IGRhdGVGb3JtYXQucmVwbGFjZShuZXcgUmVnRXhwKCd5JywgJ2cnKSwgJ2snKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGRhdGVGb3JtYXQ7XHJcbiAgICB9XHJcbn1cclxuIl19