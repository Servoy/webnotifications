import { Injectable } from '@angular/core';
import * as i0 from "@angular/core";
import * as i1 from "./services/windowref.service";
// log levels for when debugEnabled(true) is called - if that is false, these levels are irrelevant
// any custom debug levels can be used as well - these are just stored here so that custom code can test the level and see if it should log its message
export var LogLevel;
(function (LogLevel) {
    LogLevel[LogLevel["ERROR"] = 1] = "ERROR";
    LogLevel[LogLevel["WARN"] = 2] = "WARN";
    LogLevel[LogLevel["INFO"] = 3] = "INFO";
    LogLevel[LogLevel["DEBUG"] = 4] = "DEBUG";
    LogLevel[LogLevel["SPAM"] = 5] = "SPAM";
})(LogLevel || (LogLevel = {}));
export class LogConfiguration {
    constructor(isDebugMode = false, level = LogLevel.WARN) {
        this.isDebugMode = isDebugMode;
        this.level = level;
    }
}
const noop = () => undefined;
export class LoggerService {
    constructor(windowRefService, svyLogConfiguration, className) {
        this.svyLogConfiguration = svyLogConfiguration;
        this.className = className;
        this.enabled = false;
        this.console = windowRefService.nativeWindow.console;
    }
    buildMessage(message) {
        if (this.enabled) {
            return message instanceof Function ? message() : message;
        }
    }
    get spam() {
        if (this.svyLogConfiguration.level >= LogLevel.SPAM) {
            this.enabled = true;
            return this.console.debug.bind(this.console, this.getTime() + ' SPAM ' + this.className + ' - ');
        }
        this.enabled = false;
        return noop;
    }
    get debug() {
        if (this.svyLogConfiguration.isDebugMode || this.svyLogConfiguration.level >= LogLevel.DEBUG) {
            this.enabled = true;
            return this.console.debug.bind(this.console, this.getTime() + ' DEBUG ' + this.className + ' - ');
        }
        this.enabled = false;
        return noop;
    }
    get info() {
        if (this.svyLogConfiguration.isDebugMode || this.svyLogConfiguration.level >= LogLevel.INFO) {
            this.enabled = true;
            return this.console.info.bind(this.console, this.getTime() + ' INFO ' + this.className + ' - ');
        }
        this.enabled = false;
        return noop;
    }
    get warn() {
        if (this.svyLogConfiguration.isDebugMode || this.svyLogConfiguration.level >= LogLevel.WARN) {
            this.enabled = true;
            return this.console.warn.bind(this.console, this.getTime() + ' WARN ' + this.className + ' - ');
        }
        this.enabled = false;
        return noop;
    }
    get error() {
        if (this.svyLogConfiguration.isDebugMode || this.svyLogConfiguration.level >= LogLevel.ERROR) {
            this.enabled = true;
            return this.console.error.bind(this.console, this.getTime() + ' ERROR ' + this.className + ' - ');
        }
        this.enabled = false;
        return noop;
    }
    toggleDebugMode() {
        return this.svyLogConfiguration.isDebugMode = !this.svyLogConfiguration.isDebugMode;
    }
    get logLevel() {
        return this.svyLogConfiguration.level;
    }
    set logLevel(level) {
        this.svyLogConfiguration.level = level;
    }
    getTime() {
        const time = new Date();
        return time.getHours() + ':' + time.getMinutes() + ':' + time.getSeconds();
    }
}
export class LoggerFactory {
    constructor(windowRefService) {
        this.windowRefService = windowRefService;
        this.instances = {};
        windowRefService.nativeWindow.logFactory = this;
        this.defaultLogConfiguration = windowRefService.nativeWindow.svyLogConfiguration;
        if (this.defaultLogConfiguration == null) {
            this.defaultLogConfiguration = new LogConfiguration();
            windowRefService.nativeWindow.svyLogConfiguration = this.defaultLogConfiguration;
            windowRefService.nativeWindow.logLevels = { error: LogLevel.ERROR, debug: LogLevel.DEBUG, info: LogLevel.INFO, warn: LogLevel.WARN, spam: LogLevel.SPAM };
        }
    }
    getLogger(cls) {
        if (this.instances[cls] === undefined) {
            this.instances[cls] = new LoggerService(this.windowRefService, new LogConfiguration(this.defaultLogConfiguration.isDebugMode, this.defaultLogConfiguration.level), cls);
        }
        return this.instances[cls];
    }
}
LoggerFactory.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.0.2", ngImport: i0, type: LoggerFactory, deps: [{ token: i1.WindowRefService }], target: i0.ɵɵFactoryTarget.Injectable });
LoggerFactory.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "12.0.2", ngImport: i0, type: LoggerFactory, providedIn: 'root' });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.0.2", ngImport: i0, type: LoggerFactory, decorators: [{
            type: Injectable,
            args: [{
                    providedIn: 'root'
                }]
        }], ctorParameters: function () { return [{ type: i1.WindowRefService }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9nZ2VyLnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9zZXJ2b3ktcHVibGljL3NyYy9saWIvbG9nZ2VyLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQzs7O0FBSTNDLG1HQUFtRztBQUNuRyx1SkFBdUo7QUFDdkosTUFBTSxDQUFOLElBQVksUUFNWDtBQU5ELFdBQVksUUFBUTtJQUNoQix5Q0FBUyxDQUFBO0lBQ1QsdUNBQUksQ0FBQTtJQUNKLHVDQUFJLENBQUE7SUFDSix5Q0FBSyxDQUFBO0lBQ0wsdUNBQUksQ0FBQTtBQUNSLENBQUMsRUFOVyxRQUFRLEtBQVIsUUFBUSxRQU1uQjtBQUVELE1BQU0sT0FBTyxnQkFBZ0I7SUFDekIsWUFBbUIsY0FBdUIsS0FBSyxFQUFTLFFBQWlCLFFBQVEsQ0FBQyxJQUFJO1FBQW5FLGdCQUFXLEdBQVgsV0FBVyxDQUFpQjtRQUFTLFVBQUssR0FBTCxLQUFLLENBQXlCO0lBQ3RGLENBQUM7Q0FDSjtBQU9ELE1BQU0sSUFBSSxHQUFHLEdBQVEsRUFBRSxDQUFDLFNBQVMsQ0FBQztBQUVsQyxNQUFNLE9BQU8sYUFBYTtJQUl0QixZQUFZLGdCQUFrQyxFQUFVLG1CQUFxQyxFQUFVLFNBQWlCO1FBQWhFLHdCQUFtQixHQUFuQixtQkFBbUIsQ0FBa0I7UUFBVSxjQUFTLEdBQVQsU0FBUyxDQUFRO1FBRmhILFlBQU8sR0FBRyxLQUFLLENBQUM7UUFHcEIsSUFBSSxDQUFDLE9BQU8sR0FBRyxnQkFBZ0IsQ0FBQyxZQUFZLENBQUMsT0FBTyxDQUFDO0lBQ3pELENBQUM7SUFFTSxZQUFZLENBQUMsT0FBa0M7UUFDbEQsSUFBSSxJQUFJLENBQUMsT0FBTyxFQUFFO1lBQ2QsT0FBTyxPQUFPLFlBQVksUUFBUSxDQUFDLENBQUMsQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDLENBQUMs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QUFJLEVBQUUsSUFBSSxFQUFFLFFBQVEsQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLFFBQVEsQ0FBQyxJQUFJLEVBQUMsQ0FBQztTQUMzSjtJQUNMLENBQUM7SUFFTSxTQUFTLENBQUMsR0FBUTtRQUNyQixJQUFJLElBQUksQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLEtBQUssU0FBUyxFQUFFO1lBQ25DLElBQUksQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLEdBQUcsSUFBSSxhQUFhLENBQUMsSUFBSSxDQUFDLGdCQUFnQixFQUFFLElBQUksZ0JBQWdCLENBQUMsSUFBSSxDQUFDLHVCQUF1QixDQUFDLFdBQVcsRUFBRSxJQUFJLENBQUMsdUJBQXVCLENBQUMsS0FBSyxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUM7U0FDM0s7UUFDRCxPQUFPLElBQUksQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDL0IsQ0FBQzs7MEdBcEJRLGFBQWE7OEdBQWIsYUFBYSxjQUZaLE1BQU07MkZBRVAsYUFBYTtrQkFIekIsVUFBVTttQkFBQztvQkFDVixVQUFVLEVBQUUsTUFBTTtpQkFDbkIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcblxyXG5pbXBvcnQgeyBXaW5kb3dSZWZTZXJ2aWNlIH0gZnJvbSAnLi9zZXJ2aWNlcy93aW5kb3dyZWYuc2VydmljZSc7XHJcblxyXG4vLyBsb2cgbGV2ZWxzIGZvciB3aGVuIGRlYnVnRW5hYmxlZCh0cnVlKSBpcyBjYWxsZWQgLSBpZiB0aGF0IGlzIGZhbHNlLCB0aGVzZSBsZXZlbHMgYXJlIGlycmVsZXZhbnRcclxuLy8gYW55IGN1c3RvbSBkZWJ1ZyBsZXZlbHMgY2FuIGJlIHVzZWQgYXMgd2VsbCAtIHRoZXNlIGFyZSBqdXN0IHN0b3JlZCBoZXJlIHNvIHRoYXQgY3VzdG9tIGNvZGUgY2FuIHRlc3QgdGhlIGxldmVsIGFuZCBzZWUgaWYgaXQgc2hvdWxkIGxvZyBpdHMgbWVzc2FnZVxyXG5leHBvcnQgZW51bSBMb2dMZXZlbCB7XHJcbiAgICBFUlJPUiA9IDEsXHJcbiAgICBXQVJOLFxyXG4gICAgSU5GTyxcclxuICAgIERFQlVHLFxyXG4gICAgU1BBTVxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgTG9nQ29uZmlndXJhdGlvbiB7XHJcbiAgICBjb25zdHJ1Y3RvcihwdWJsaWMgaXNEZWJ1Z01vZGU6IGJvb2xlYW4gPSBmYWxzZSwgcHVibGljIGxldmVsOiBMb2dMZXZlbD0gTG9nTGV2ZWwuV0FSTikge1xyXG4gICAgfVxyXG59XHJcblxyXG5kZWNsYXJlIGdsb2JhbCB7XHJcbiAgICAvLyBleHRlbmQgdGhlIGV4aXN0aW5nIHdpbmRvdyBpbnRlcmZhY2Ugd2l0aCB0aGUgbmV3IGxvZyBwcm92aWRlciBwcm9wZXJ0eVxyXG4gICAgaW50ZXJmYWNlIFdpbmRvdyB7IHN2eUxvZ0NvbmZpZ3VyYXRpb246IExvZ0NvbmZpZ3VyYXRpb247IGxvZ0ZhY3Rvcnk6IExvZ2dlckZhY3Rvcnk7IGxvZ0xldmVsczoge1twcm9wZXJ0eTogc3RyaW5nXTogTG9nTGV2ZWx9OyBjb25zb2xlOiBDb25zb2xlIH1cclxufVxyXG5cclxuY29uc3Qgbm9vcCA9ICgpOiBhbnkgPT4gdW5kZWZpbmVkO1xyXG5cclxuZXhwb3J0IGNsYXNzIExvZ2dlclNlcnZpY2Uge1xyXG4gICAgcHJpdmF0ZSBjb25zb2xlOiBDb25zb2xlO1xyXG4gICAgcHJpdmF0ZSBlbmFibGVkID0gZmFsc2U7XHJcblxyXG4gICAgY29uc3RydWN0b3Iod2luZG93UmVmU2VydmljZTogV2luZG93UmVmU2VydmljZSwgcHJpdmF0ZSBzdnlMb2dDb25maWd1cmF0aW9uOiBMb2dDb25maWd1cmF0aW9uLCBwcml2YXRlIGNsYXNzTmFtZTogc3RyaW5nICkge1xyXG4gICAgICAgIHRoaXMuY29uc29sZSA9IHdpbmRvd1JlZlNlcnZpY2UubmF0aXZlV2luZG93LmNvbnNvbGU7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGJ1aWxkTWVzc2FnZShtZXNzYWdlOiBzdHJpbmcgfCAoICgpID0+IHN0cmluZyApKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZW5hYmxlZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbWVzc2FnZSBpbnN0YW5jZW9mIEZ1bmN0aW9uID8gbWVzc2FnZSgpIDogbWVzc2FnZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IHNwYW0oKSB7XHJcbiAgICAgICAgaWYgKCB0aGlzLnN2eUxvZ0NvbmZpZ3VyYXRpb24ubGV2ZWwgPj0gTG9nTGV2ZWwuU1BBTSApIHtcclxuICAgICAgICAgICAgdGhpcy5lbmFibGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29uc29sZS5kZWJ1Zy5iaW5kKHRoaXMuY29uc29sZSwgdGhpcy5nZXRUaW1lKCkgKyAnIFNQQU0gJyArIHRoaXMuY2xhc3NOYW1lICsgJyAtICcpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmVuYWJsZWQgPSBmYWxzZTtcclxuICAgICAgICByZXR1cm4gbm9vcDtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgZGVidWcoKSB7XHJcbiAgICAgICAgaWYgKCB0aGlzLnN2eUxvZ0NvbmZpZ3VyYXRpb24uaXNEZWJ1Z01vZGUgfHwgdGhpcy5zdnlMb2dDb25maWd1cmF0aW9uLmxldmVsID49IExvZ0xldmVsLkRFQlVHICkge1xyXG4gICAgICAgICAgICB0aGlzLmVuYWJsZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jb25zb2xlLmRlYnVnLmJpbmQodGhpcy5jb25zb2xlLCB0aGlzLmdldFRpbWUoKSArICcgREVCVUcgJyArIHRoaXMuY2xhc3NOYW1lICsgJyAtICcpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmVuYWJsZWQgPSBmYWxzZTtcclxuICAgICAgICByZXR1cm4gbm9vcDtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgaW5mbygpIHtcclxuICAgICAgICBpZiAoIHRoaXMuc3Z5TG9nQ29uZmlndXJhdGlvbi5pc0RlYnVnTW9kZSB8fCB0aGlzLnN2eUxvZ0NvbmZpZ3VyYXRpb24ubGV2ZWwgPj0gTG9nTGV2ZWwuSU5GTyApIHtcclxuICAgICAgICAgICAgdGhpcy5lbmFibGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29uc29sZS5pbmZvLmJpbmQodGhpcy5jb25zb2xlLCB0aGlzLmdldFRpbWUoKSArICcgSU5GTyAnICsgdGhpcy5jbGFzc05hbWUgKyAnIC0gJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuZW5hYmxlZCA9IGZhbHNlO1xyXG4gICAgICAgIHJldHVybiBub29wO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCB3YXJuKCkge1xyXG4gICAgICAgIGlmICggdGhpcy5zdnlMb2dDb25maWd1cmF0aW9uLmlzRGVidWdNb2RlIHx8IHRoaXMuc3Z5TG9nQ29uZmlndXJhdGlvbi5sZXZlbCA+PSBMb2dMZXZlbC5XQVJOICkge1xyXG4gICAgICAgICAgICB0aGlzLmVuYWJsZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jb25zb2xlLndhcm4uYmluZCh0aGlzLmNvbnNvbGUsIHRoaXMuZ2V0VGltZSgpICsgJyBXQVJOICcgKyB0aGlzLmNsYXNzTmFtZSArICcgLSAnKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5lbmFibGVkID0gZmFsc2U7XHJcbiAgICAgICAgcmV0dXJuIG5vb3A7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGVycm9yKCkge1xyXG4gICAgICAgIGlmICggdGhpcy5zdnlMb2dDb25maWd1cmF0aW9uLmlzRGVidWdNb2RlIHx8IHRoaXMuc3Z5TG9nQ29uZmlndXJhdGlvbi5sZXZlbCA+PSBMb2dMZXZlbC5FUlJPUiApIHtcclxuICAgICAgICAgICAgdGhpcy5lbmFibGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29uc29sZS5lcnJvci5iaW5kKHRoaXMuY29uc29sZSwgdGhpcy5nZXRUaW1lKCkgKyAnIEVSUk9SICcgKyB0aGlzLmNsYXNzTmFtZSArICcgLSAnKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5lbmFibGVkID0gZmFsc2U7XHJcbiAgICAgICAgcmV0dXJuIG5vb3A7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHRvZ2dsZURlYnVnTW9kZSgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5zdnlMb2dDb25maWd1cmF0aW9uLmlzRGVidWdNb2RlID0gIXRoaXMuc3Z5TG9nQ29uZmlndXJhdGlvbi5pc0RlYnVnTW9kZTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgbG9nTGV2ZWwoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuc3Z5TG9nQ29uZmlndXJhdGlvbi5sZXZlbDtcclxuICAgIH1cclxuXHJcbiAgICBzZXQgbG9nTGV2ZWwobGV2ZWw6IExvZ0xldmVsKSB7XHJcbiAgICAgICAgdGhpcy5zdnlMb2dDb25maWd1cmF0aW9uLmxldmVsID0gbGV2ZWw7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRUaW1lKCk6IHN0cmluZyB7XHJcbiAgICAgICAgY29uc3QgdGltZSA9IG5ldyBEYXRlKCk7XHJcbiAgICAgICAgcmV0dXJuIHRpbWUuZ2V0SG91cnMoKSArICc6JyArIHRpbWUuZ2V0TWludXRlcygpICsgJzonICsgdGltZS5nZXRTZWNvbmRzKCk7XHJcbiAgICB9XHJcbiB9XHJcblxyXG5ASW5qZWN0YWJsZSh7XHJcbiAgcHJvdmlkZWRJbjogJ3Jvb3QnXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBMb2dnZXJGYWN0b3J5IHtcclxuXHJcbiAgICBwcml2YXRlIGluc3RhbmNlczogYW55ID0ge307XHJcbiAgICBwcml2YXRlIGRlZmF1bHRMb2dDb25maWd1cmF0aW9uOiBMb2dDb25maWd1cmF0aW9uO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgd2luZG93UmVmU2VydmljZTogV2luZG93UmVmU2VydmljZSApIHtcclxuICAgICAgICB3aW5kb3dSZWZTZXJ2aWNlLm5hdGl2ZVdpbmRvdy5sb2dGYWN0b3J5ID0gdGhpcztcclxuICAgICAgICB0aGlzLmRlZmF1bHRMb2dDb25maWd1cmF0aW9uID0gd2luZG93UmVmU2VydmljZS5uYXRpdmVXaW5kb3cuc3Z5TG9nQ29uZmlndXJhdGlvbjtcclxuICAgICAgICBpZiAoIHRoaXMuZGVmYXVsdExvZ0NvbmZpZ3VyYXRpb24gPT0gbnVsbCApIHtcclxuICAgICAgICAgICAgdGhpcy5kZWZhdWx0TG9nQ29uZmlndXJhdGlvbiA9IG5ldyBMb2dDb25maWd1cmF0aW9uKCk7XHJcbiAgICAgICAgICAgIHdpbmRvd1JlZlNlcnZpY2UubmF0aXZlV2luZG93LnN2eUxvZ0NvbmZpZ3VyYXRpb24gPSB0aGlzLmRlZmF1bHRMb2dDb25maWd1cmF0aW9uO1xyXG4gICAgICAgICAgICB3aW5kb3dSZWZTZXJ2aWNlLm5hdGl2ZVdpbmRvdy5sb2dMZXZlbHMgPSB7ZXJyb3I6IExvZ0xldmVsLkVSUk9SLCBkZWJ1ZzogTG9nTGV2ZWwuREVCVUcsIGluZm86IExvZ0xldmVsLklORk8sIHdhcm46IExvZ0xldmVsLldBUk4sIHNwYW06IExvZ0xldmVsLlNQQU19O1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZ2V0TG9nZ2VyKGNsczogYW55KTogTG9nZ2VyU2VydmljZSB7XHJcbiAgICAgICAgaWYgKHRoaXMuaW5zdGFuY2VzW2Nsc10gPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICB0aGlzLmluc3RhbmNlc1tjbHNdID0gbmV3IExvZ2dlclNlcnZpY2UodGhpcy53aW5kb3dSZWZTZXJ2aWNlLCBuZXcgTG9nQ29uZmlndXJhdGlvbih0aGlzLmRlZmF1bHRMb2dDb25maWd1cmF0aW9uLmlzRGVidWdNb2RlLCB0aGlzLmRlZmF1bHRMb2dDb25maWd1cmF0aW9uLmxldmVsKSwgY2xzKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaW5zdGFuY2VzW2Nsc107XHJcbiAgICB9XHJcbn1cclxuIl19